<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/pico.cyan.min.css" />
    <link rel="stylesheet" href="/common.css" />
    <link rel="stylesheet" href="/index.css" />
    <title>Ophir 2D - Login</title>
</head>

<body>
    <div class="navbar">
        <a href="mailto:adrianpope@proton.me">(üêû||ü§ù)&&‚úâÔ∏è</a>
        <a href="/about">How to Play</a>
    </div>
    <div class="content">
        <h2>
            Ophir 2D
        </h2>
        <div id="formbox">
            <div id="issue" style="color:brown"></div>
            <div class="form" id="registration" style="visibility: hidden;">
                <h3>Create Account</h3>
                <form method="post" action="/register">
                    <input type="text" name="userName" placeholder="user name (not displayed)">
                    <input type="text" name="password" placeholder="suggested strong password">
                    <input type="text" name="pwRetype" placeholder="password again">
                    <input type="submit" value="Create">
                </form>
            </div>
            <div class="form" id="login" style="visibility: visible;">
                <h3>Login</h3>
                <form method="post" action="/login">
                    <input type="text" name="userName" placeholder="user name">
                    <input type="text" name="password" placeholder="pasword">
                    <input type="text" style="visibility: hidden;">
                    <input type="submit" value="Log in">
                </form>
            </div>
            <a id="switch-link">Create Account</a>
        </div>
    </div>
    <script>
        window.addEventListener('pageshow', (event) => {
            if (event.persisted)
                window.location.reload();
        });

        let isLogin = true;
        const switchLink = document.querySelector('#switch-link');
        const registration = document.querySelector('#registration');
        const login = document.querySelector('#login');
        switchLink.addEventListener('click', () => {
            login.style.visibility = isLogin ? 'hidden' : 'visible';
            registration.style.visibility = isLogin ? 'visible' : 'hidden';
            isLogin = !isLogin;
            switchLink.innerText = isLogin ? 'Create Account' : 'Login';
        });

        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', async (event) => {
                event.preventDefault();
                const uri = event.target.action;
                const init = {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams(new FormData(event.target))
                }

                try {
                    const response = await fetch(uri, init);
                    if (response.status === 200) {
                        window.location.href = '/lobby';
                    } else {
                        const text = await response.text();
                        document.querySelector('#issue').innerText = text;
                    }
                } catch (error) {
                    console.error(error)
                }
            });
        });
    </script>
</body>

</html>